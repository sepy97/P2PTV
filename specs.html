<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>P2PTV</title>
  </head>
  <body>

<h1 style="color: #5e9ca0;">P2P трансляция</h1>
<h2 style="color: #2e6c80;">Что работает сейчас:</h2>
<p> Трансляция запускается через VLC, т.е. требовалось установить VLC и запустить команду <br>
<code>  cvlc -vvv /home/user/Downloads/SHEV.mp4 --sout '#transcode{vcodec=theo,vb=800,acodec=vorb,ab=128,channels=2,samplerate=44100}:http{dst=:8080/webcam.ogg}' :no-sout-all :sout-keep</code>, <br>
  где  <code>/home/user/Downloads/SHEV.mp4</code> - путь к транслируемому файлу. <br>
HTML страница br.html содержит в себе тег html5 видео плеера, в источнике которого указан адрес, куда транслируется поток с vlc (v57609.vdi...). 
</p>
<p> VLC отправляет поток webcam.ogg,  html5 плеер забирает этот поток на html странице, которая находится на nginx сервере, доступ к которому организован через ssh с проброшенным портом. </p>
<h2 style="color: #2e6c80;">Что в планах:</h2>
<p> Собственно трансляция должна идти с камеры на один из пиров P2P сети, дальше поток будет раздаваться между остальными пирами (чем их больше - тем лучше). Если они находятся в одной сети, задержка будет минимальной, что позволит сделать обратную связь для трансляций курсов и консультаций эффективной. </p>
<p> Техническая сторона вопроса - WebRTC. Этот проект с открытым исходным кодом Google активно развивает с 2012 г., а первый стабильный релиз появился в 2013 г. Сейчас WebRTC уже хорошо поддерживается самыми распространенными современными браузерами, за исключением MS Edge. Технология WebRTC позволяет устроить видеоконференцию между двумя или несколькими пользователями по принципу P2P. Таким образом, данные между пользователями передаются напрямую, а не через сервер. Впрочем, сервер нам все равно понадобится, но об этом скажу далее. Прежде всего, WebRTC рассчитана на работу в браузере, но есть и библиотеки для разных платформ, которые тоже позволяют использовать WebRTC-соединение. </p>
<p> Для маршрутизации WebRTC предлагает использовать протокол Session Traversal Utilities for NAT (STUN), позволяющий установить только UDP-соединение. Впрочем, есть возможность использовать другой протокол (уже немного устаревший) - Traversal Using Relay NAT (TURN), который позволяет узлу за NAT или межсетевым экраном получать входящие данные через TCP или UDP-соединения.
</p>
<p>
  Важно учесть программные ограничения — мы можем подключить не более 256 пиров к одному инстансу WebRTC. Впрочем, для узкой специализации (каким и является этот проект - потенциальная аудитория не превосходит 5000, достаточно 20 из этих пиров обладать более-менее сносным сетевым каналом) это ограничение несущественно.
</p>
  </body>
</html>
